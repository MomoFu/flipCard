!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.WebStorageCache=t()}(this,function(){"use strict";function e(e,t){for(var r in t)e[r]=t[r];return e}function t(e){var t=!1;if(e&&e.setItem){t=!0;var r="__"+Math.round(1e7*Math.random());try{e.setItem(r,r),e.removeItem(r)}catch(e){t=!1}}return t}function r(e){var t=typeof e;return"string"===t&&window[e]instanceof Storage?window[e]:e}function n(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())}function i(e,t){if(t=t||new Date,"number"==typeof e?e=e===1/0?l:new Date(t.getTime()+1e3*e):"string"==typeof e&&(e=new Date(e)),e&&!n(e))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return e}function o(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else-2147024882===e.number&&(t=!0);return t}function a(e,t){this.c=(new Date).getTime(),t=t||l;var r=i(t);this.e=r.getTime(),this.v=e}function s(e){return!!(e&&"c"in e&&"e"in e&&"v"in e)}function c(e){var t=(new Date).getTime();return t<e.e}function u(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function f(n){var i={storage:"localStorage",exp:1/0},o=e(i,n),a=r(o.storage),s=t(a);this.isSupported=function(){return s},s?(this.storage=a,this.quotaExceedHandler=function(e,t,r){if(console.warn("Quota exceeded!"),r&&r.force===!0){var n=this.deleteAllExpires();console.warn("delete all expires CacheItem : ["+n+"] and try execute `set` method again!");try{r.force=!1,this.set(e,t,r)}catch(e){console.warn(e)}}}):e(this,d)}var l=new Date("Fri, 31 Dec 9999 23:59:59 UTC"),h={serialize:function(e){return JSON.stringify(e)},deserialize:function(e){return e&&JSON.parse(e)}},d={set:function(){},get:function(){},delete:function(){},deleteAllExpires:function(){},clear:function(){},add:function(){},replace:function(){},touch:function(){}},g={set:function(t,r,n){if(t=u(t),n=e({force:!0},n),void 0===r)return this.delete(t);var i=h.serialize(r),s=new a(i,n.exp);try{this.storage.setItem(t,h.serialize(s))}catch(e){o(e)?this.quotaExceedHandler(t,i,n,e):console.error(e)}return r},get:function(e){e=u(e);var t=null;try{t=h.deserialize(this.storage.getItem(e))}catch(e){return null}if(s(t)){if(c(t)){var r=t.v;return h.deserialize(r)}this.delete(e)}return null},delete:function(e){return e=u(e),this.storage.removeItem(e),e},deleteAllExpires:function(){for(var e=this.storage.length,t=[],r=this,n=0;e>n;n++){var i=this.storage.key(n),o=null;try{o=h.deserialize(this.storage.getItem(i))}catch(e){}if(null!==o&&void 0!==o.e){var a=(new Date).getTime();a>=o.e&&t.push(i)}}return t.forEach(function(e){r.delete(e)}),t},clear:function(){this.storage.clear()},add:function(t,r,n){t=u(t),n=e({force:!0},n);try{var i=h.deserialize(this.storage.getItem(t));if(!s(i)||!c(i))return this.set(t,r,n),!0}catch(e){return this.set(t,r,n),!0}return!1},replace:function(e,t,r){e=u(e);var n=null;try{n=h.deserialize(this.storage.getItem(e))}catch(e){return!1}if(s(n)){if(c(n))return this.set(e,t,r),!0;this.delete(e)}return!1},touch:function(e,t){e=u(e);var r=null;try{r=h.deserialize(this.storage.getItem(e))}catch(e){return!1}if(s(r)){if(c(r))return this.set(e,this.get(e),{exp:t}),!0;this.delete(e)}return!1}};return f.prototype=g,f});